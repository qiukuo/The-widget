<!-- 
    content:   自动机作业
    author：litkk
    time: 2014.10.19
 -->

<!DOCTYPE html>
<HTML lang="en">
<head>

	<meta charset="utf-8">
	<title>形式语言</title>
	<style>
	*{
		margin: 0px;
		padding: 0px;
	}
    body{
        width:600px;
        margin: 50px auto;
    }
	</style>
</head>
    <body>
        <div>
            <input id="go" type="text" value="4">
        </div>
        <textarea id="mes">

        </textarea>
    	<script type="text/javascript">

            // 初始的数据
            var wen={
               fi:"S",
               se:"a,b",
               th:"S%Sa,S%a",
               fo:"S"
            };

            var wenf=new Array();
            var wenc=new Array();
            var wens=new Array();
            var end=wen.fo;
            var mes=document.getElementById("mes");

            window.onload=main()
            
            // 信息提示函数
            function mesShow(mestext){
                mes.value=mestext;
            }

            function main(){
                var max=document.getElementById("go").value;
                isOk1()
            } 
            // 判定是否存在的工具函数
            function isIn(a,array){
                var re=false;
                for(var i=0;i<array.length;i++){
                    if(a==array[i]){
                        re=true;
                    }
                }
                return re;
            }

            // 判定格式是否正确
            function isOk1(){
                wenf=wen.fi.split(",");
                for(var i=0;i<wenf.length;i++){
                    wenf[i]=wenf[i].split("")
                    if(wenf[i][1]){
                        mesShow("false:非终极符格式错误");
                        return false;
                    }
                }
                if(!isIn(wen.fo,wenf)){
                    mesShow("false:开始符号不在非终极符中");
                    return false;
                }
                // 终极符错误
                wenc=(wen.se).split(",");
                for(var i=0;i<wenc.length;i++){
                    var changewenc=wenc[i].split("");
                    for(var n=0;n<changewenc.length;n++){
                        if(changewenc[1]){
                            mesShow("false:终极符格式错误");
                            return false;
                        }
                    }
                    
                    if(isIn(wenc[i],wenf)){
                        mesShow("false:终极符不可以和非终级符相同");
                        return false;
                    }
                }
                // 产生式变化
                var nwens=wen.th.split(",");
                for(var i=0;i<nwens.length;i++){
                    wens[i]=new Array()
                    wens[i][0]=(wen.th).split(",")[i].split("%")[0];
                    wens[i][1]=(wen.th).split(",")[i].split("%")[1];
                    wens[i][0]= wens[i][0].split("");
                    wens[i][1]= wens[i][1].split("");
                }
                // 左部
                for(var i=0;i<wens.length;i++){
                    if(wens[i][0][1]){
                        mesShow("false:产生式左部有错误");
                        return false;
                    }
                    if(!isIn(wens[i][0][0],wenf)){
                        mesShow("false:产生式左部不在非终极符中");
                        return false;
                    }
                }
                // 右部

                for(var i=0;i<wens.length;i++){
                    for(var n=0;n<wens[i][1].length;n++){
                        if(!isIn(wens[i][1][n],wenf)&&!isIn(wens[i][1][n],wenc)){
                            mesShow("false:产生式右部中不在非终极符或终级符中");
                            return false;
                        }
                    }
                }
            }

            function gogogo(){
                var newend=end.split("")
                var inend=newend;
                p:for(var i=0;i<newend.length;i++){
                    for(var n=0;n<wens.length;n++){
                       if(newend[i]==wens[n][0][0]){
                            for(var j=0;j<wens[n][1].length;j++){
                                if(isIn(wens[n][1][j],wenc)){
                                    newend.splice(i,1,wens[n][1])
                                }
                            }

                            inend.splice(i,1,wens[n][1])
                            break p;
                       }
                    }
                }
                end=newend.join("")
                mes.value=mes.value+end+"\n"
            }     
      	</script>
    </body>
</html>

